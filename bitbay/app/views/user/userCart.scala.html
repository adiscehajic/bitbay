@(cartItems : List[CartItem])(user: User)
@import helpers.SessionHelper;
@import helper._

@main("Cart") {

    <div class="panel panel-primary">
        <div class="panel-heading">
            <div class="panel-title">@user.firstName's Cart</div>
        </div>
        <div class="panel-body">
        @if(cartItems == null || cartItems.length == 0) {
            <h2 align="center"> Your cart is empty! </h2>
            <br>
            <a href="@routes.ApplicationController.index()"><button class="btn btn-primary center-block"> Homepage </button></a>
        } else {
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th> Product </th>
                        <th></th>
                        <th> Quantity </th>
                        <th> Price </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @for(cartItem <- cartItems) {
                        <form method="POST" action="@helper.CSRF(routes.CartController.updateItemQuantity(cartItem.id))" name="myForm">
                        <tr>
                        @if(cartItem.product.images.size() > 0) {
                            <td class="cartData" width="150px"><a href="@routes.ProductController.getProduct(cartItem.product.id)">
                                <img src="@cartItem.product.images.get(0).getSize(150, 150)"/>
                            </a></td>
                        }else {
                            <td class="cartData" width="150px"><a href="@routes.ProductController.getProduct(cartItem.product.id)">
                                <img src="http://placehold.it/140x120"/>
                            </a></td>
                        }
                            <td class="cartData" style="font-size : 17px"><a href="@routes.ProductController.getProduct(cartItem.product.id)"> @cartItem.product.name </a></td>
                            <td class="cartData" style="align: center;"><input type="number" style="display:inline" id="replyNumber" data-bind="value:replyNumber" onfocusout="quantityValidator()" min="1" max="@cartItem.product.quantity" value="@cartItem.quantity" name="quantity"><br><button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-floppy-save"></span></button></td>
                            <td class="cartData"> @cartItem.price KM</td>
                            <td class="cartData"><a href="#" id="delete@cartItem.id"><span class="glyphicon glyphicon-remove" style="font-size : 20 px"></span></a></td>
                        </tr>
                        </form>
                        <script >
                          $(document).ready(function(){
                          $('#delete@cartItem.id').click(function(){
                             $.confirm({
                                title: 'You are about to delete cart item' + @cartItem.id,
                                content: 'Are you really sure?',
                                theme: 'supervan',
                                confirmButtonClass: 'btn-danger',
                                cancelButtonClass: 'btn-info',
                                 confirmButton: 'Delete',
                                 cancelButton: 'Cancel',
                                 backgroundDismiss: false,
                                   confirm: function(){
                                    $.ajax({
                                       url: '@routes.CartController.removeFromCart(cartItem.id)',
                                       method: 'DELETE',
                                        }).success(function(){
                                         window.location.replace("@routes.CartController.getCart()");
                                          }).error(function(response){
                                          alert(response.responseText);
                                           });
                                           },
                                          cancel: function(){
                                        }
                                   });
                                 })
                             })
                     </script>
                    }
                </tbody>
            </table>
            <div class="row">
                <div class="col-md-8"></div>
                <div class="col-md-4" align="center">
                    <label> Total: @Cart.cartAmount(user) KM </label>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8"></div>
                <div class="col-md-4" align="center">
                <button class="btn btn-primary"> Checkout </button></div>
            </div>
            }
        </div>
    </div>
}